<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><title itemprop=name>Flash Xiaomi LYWSD03MMC BLE sensor with Zigbee firmware :: Sequr (dev)</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=robots content="noodp, noydir"><meta name=googlebot content="noodp, noydir"><link rel=canonical href=https://dev.sequr.be/ itemprop=url><meta name=url content="https://dev.sequr.be/"><link rel=icon href=/favicon.ico><meta itemprop=name content="Sequr (dev)"><meta itemprop=description content="Dev version of sequr.be. This site may break at any time."><meta itemprop=datePublished content="2024-11-20T00:00:00+01:00"><meta itemprop=dateModified content="2024-11-20T00:00:00+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Sequr (dev)"><meta name=twitter:description content="Dev version of sequr.be. This site may break at any time."><meta property="og:url" content="https://dev.sequr.be/"><meta property="og:site_name" content="Sequr (dev)"><meta property="og:title" content="Sequr (dev)"><meta property="og:description" content="Dev version of sequr.be. This site may break at any time."><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta name=description content="Dev version of sequr.be. This site may break at any time."><meta itemprop=description content="Dev version of sequr.be. This site may break at any time."><meta property="og:updated_time" content="2024-11-20T00:00:00+01:00"><link rel=sitemap type=application/xml title=Sitemap href=https://dev.sequr.be/sitemap.xml><link href=https://dev.sequr.be/index.xml rel=alternate type=application/rss+xml title="Sequr (dev)"><meta name=apple-mobile-web-app-title content="Sequr (dev)"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><link rel=stylesheet href=/css/bundle.css><script defer type=text/javascript src=/js/bundle.min.145453261a7755f5042a854c4213501d215a8fbe34c08d181c40f803f1315e74.js integrity="sha256-FFRTJhp3VfUEKoVMQhNQHSFaj740wI0YHED4A/ExXnQ=" crossorigin=anonymous></script></head><body class=dark-theme><div class=wrapper><aside class="sidebar h-card background-image"><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class="sidebar-about hcard"><h1 class=brand><a href=https://dev.sequr.be/><img src=/logo.png class="u-logo u-photo" alt="Sequr (dev) brand image">
</a><a href=https://dev.sequr.be/ class="u-url p-org"><h1>Sequr (dev)</h1></a></h1><p class="lead p-note">Dev version of sequr.be. This site may break at any time.</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/about/ title=About>About</a></li><li class=heading><a href=/blog/ title=Blog>Blog</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://dev.sequr.be/blog/2024/09/flashing-the-ikea-vindriktning-with-tasmota-and-esphome/ title="Flashing the IKEA Vindriktning with Tasmota and ESPHome">IKEA Vindriktning in HA</a></li><li class=bullet><a href=https://dev.sequr.be/blog/2024/02/home-assistant-container-part-13-vs-code-code-server/ title="Home Assistant Container Part 13: VS Code code-server">HA Containter pt13: VS Code</a></li><li class=bullet><a href=https://dev.sequr.be/blog/2024/02/flash-xiaomi-lywsd03mmc-ble-sensor-with-zigbee-firmware/ title="Flash Xiaomi LYWSD03MMC BLE sensor with Zigbee firmware">Xiaomi LYWSD03MMC with Zigbee</a></li><li class=bullet><a href=https://dev.sequr.be/blog/2023/12/remotely-opening-and-closing-my-gate/ title="Remotely opening and closing my gate">HA gate controller</a></li><li class=bullet><a href=https://dev.sequr.be/blog/2023/10/2-months-in/ title="2 months in">2 months in</a></li><li class=heading><a href=/shoppinglist/ title="Shopping List">Shopping</a></li><li class=heading><a href=/privacy/ title="Privacy Statement">Privacy</a></li></ul></nav><a target=_blank class=social title="RSS Feed" href=/blog/index.xml><svg width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg>
</a><a href=https://bsky.app/profile/sequr.be target=_blank class="u-url social" rel="external noopener me" title=Bluesky><svg width="1.2em" height="1.2em" viewBox="0 0 568 501"><path fill="currentcolor" d="M123.121 33.6637C188.241 82.5526 258.281 181.681 284 234.873c25.719-53.192 95.759-152.3204 160.879-201.2093C491.866-1.61183 568-28.9064 568 57.9464 568 75.2916 558.055 203.659 552.222 224.501c-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281C285.169 375.812 284.017 372.431 284 375.306 283.983 372.431 282.831 375.812 280.369 383.039c-13.43 39.422-65.842 193.273-185.7023 70.281C31.5556 388.56 60.7778 323.8 175.653 304.249 109.933 315.434 36.0535 296.954 15.7778 224.501 9.94525 203.659.0 75.2916.0 57.9464.0-28.9064 76.1345-1.61183 123.121 33.6637z"/></svg></a><a href=https://mastodon-belgium.be/@TerraGloba target=_blank class="u-url social" rel="external noopener me" title=Mastodon><svg width="1.2em" height="1.2em" viewBox="0 0 568 501"><path fill="currentcolor" d="M123.121 33.6637C188.241 82.5526 258.281 181.681 284 234.873c25.719-53.192 95.759-152.3204 160.879-201.2093C491.866-1.61183 568-28.9064 568 57.9464 568 75.2916 558.055 203.659 552.222 224.501c-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281C285.169 375.812 284.017 372.431 284 375.306 283.983 372.431 282.831 375.812 280.369 383.039c-13.43 39.422-65.842 193.273-185.7023 70.281C31.5556 388.56 60.7778 323.8 175.653 304.249 109.933 315.434 36.0535 296.954 15.7778 224.501 9.94525 203.659.0 75.2916.0 57.9464.0-28.9064 76.1345-1.61183 123.121 33.6637z"/></svg></a><a href=https://github.com/TheGroundZero target=_blank class="u-url social" rel="external noopener me" title=Github><svg width="1.2em" height="1.2em" viewBox="0 0 568 501"><path fill="currentcolor" d="M123.121 33.6637C188.241 82.5526 258.281 181.681 284 234.873c25.719-53.192 95.759-152.3204 160.879-201.2093C491.866-1.61183 568-28.9064 568 57.9464 568 75.2916 558.055 203.659 552.222 224.501c-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281C285.169 375.812 284.017 372.431 284 375.306 283.983 372.431 282.831 375.812 280.369 383.039c-13.43 39.422-65.842 193.273-185.7023 70.281C31.5556 388.56 60.7778 323.8 175.653 304.249 109.933 315.434 36.0535 296.954 15.7778 224.501 9.94525 203.659.0 75.2916.0 57.9464.0-28.9064 76.1345-1.61183 123.121 33.6637z"/></svg></a><a href=https://twitter.com/DezeStijn target=_blank class="u-url social" rel="external noopener me" title=Twitter><svg width="1.2em" height="1.2em" viewBox="0 0 568 501"><path fill="currentcolor" d="M123.121 33.6637C188.241 82.5526 258.281 181.681 284 234.873c25.719-53.192 95.759-152.3204 160.879-201.2093C491.866-1.61183 568-28.9064 568 57.9464 568 75.2916 558.055 203.659 552.222 224.501c-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281C285.169 375.812 284.017 372.431 284 375.306 283.983 372.431 282.831 375.812 280.369 383.039c-13.43 39.422-65.842 193.273-185.7023 70.281C31.5556 388.56 60.7778 323.8 175.653 304.249 109.933 315.434 36.0535 296.954 15.7778 224.501 9.94525 203.659.0 75.2916.0 57.9464.0-28.9064 76.1345-1.61183 123.121 33.6637z"/></svg></a><a href=https://ko-fi.com/s4squatch target=_blank class="u-url social" rel="external noopener" title=Kofi><svg width="1.2em" height="1.2em" viewBox="0 0 568 501"><path fill="currentcolor" d="M123.121 33.6637C188.241 82.5526 258.281 181.681 284 234.873c25.719-53.192 95.759-152.3204 160.879-201.2093C491.866-1.61183 568-28.9064 568 57.9464 568 75.2916 558.055 203.659 552.222 224.501c-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281C285.169 375.812 284.017 372.431 284 375.306 283.983 372.431 282.831 375.812 280.369 383.039c-13.43 39.422-65.842 193.273-185.7023 70.281C31.5556 388.56 60.7778 323.8 175.653 304.249 109.933 315.434 36.0535 296.954 15.7778 224.501 9.94525 203.659.0 75.2916.0 57.9464.0-28.9064 76.1345-1.61183 123.121 33.6637z"/></svg></a><p class=footnote>&copy; 2019
• <a class="p-name u-url" href=https://sequr.be>Sequr</a>
• <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel="external noopener">CC BY-NC-SA 4.0</a></p></div></aside><section class="content container"><article class="post h-entry"><header class=info><h1 class="post-title p-name u-url"><a href=https://dev.sequr.be/blog/2024/02/flash-xiaomi-lywsd03mmc-ble-sensor-with-zigbee-firmware/>Flash Xiaomi LYWSD03MMC BLE sensor with Zigbee firmware</a></h1><div class=headline><div><span class="h-card p-author">DezeStijn
</span><span>• </span><time datetime=2024-02-09T00:00:00+0100 class="post-date dt-published">Feb 9, 2024
</time><time datetime=2024-02-21T00:00:00+0100 class="post-date dt-updated">(Feb 21, 2024)
</time><span>• </span><span class=reading-time><span>3 mins read</span></span></div><ul class=tags><li class="tag-Home Automation"><a class=p-category href=https://dev.sequr.be/tags/home-automation>Home Automation</a></li></ul></div></header><main class=e-content><h2 id=intro>Intro</h2><p>In 2021 I <a href=https://dev.sequr.be/blog/2021/01/room-temperature-monitoring-using-xiaomi-temperature-sensor-esp32-and-esphome/ title="Room temperature monitoring using Xiaomi temperature sensor, ESP32 and ESPHome">wrote</a> about some awesome cheap Xiaomi temperature and humudity sensors.
They come with a very battery-efficient eInk screen and all you needed to incorporate them into Home Assistant was an ESP32 flashed with the <a href="https://esphome.io/projects/?type=bluetooth" title="ESPHome Bluetooth Proxy firmware" rel=external target=_blank>Bluetooth Proxy</a> firmware.</p><p>Recently, I discovered the small square LYWSD03MMC sensors not only can be flashed to support the <a href=https://bthome.io title="BTHome is an open standard for broadcasting sensor data and button presses over Bluetooth LE" rel=external target=_blank>BTHome</a> BLE broadcast format, but there now exists an (experimental) firmware that enables the sensors to communicate via Zigbee as well.
Zigbee2MQTT (and maybe also ZHA) support these devices, giving you another method of integrating these in Home Assistant :)</p><h2 id=flashing-the-lywsd03mmc>Flashing the LYWSD03MMC</h2><h3 id=requirements>Requirements</h3><p>All you need for this process are:</p><ul><li>a <a href=https://s.click.aliexpress.com/e/_DnMgqhF title="Xiaomi Mi Bluetooth temperature/humidity sensor LYWSD03MMC" rel=external target=_blank>Xiaomi LYWSD03MMC</a> temperature and humidity sensor</li><li>a laptop/computer/&mldr; with Edge, Chrome or Opera browser</li></ul><figure class=center><img src=xiaomi_sensor_LYWSD03MMC.png alt="Xiaomi LYWSD03MMC"><figcaption class=center>Xiaomi LYWSD03MMC</figcaption></figure><h3 id=flashing-process>Flashing process</h3><p>First, in your browser, enable the Expirimental Web Platform Features</p><ul><li>Edge: edge://flags/#enable-experimental-web-platform-features</li><li>Chrome: chrome://flags/#enable-experimental-web-platform-features</li><li>Opera: opera://flags/#enable-experimental-web-platform-features</li></ul><p>Open the <a href=https://pvvx.github.io/ATC_MiThermometer/TelinkMiFlasher.html title="Telink Flasher for Mi Thermostat by pvvx" rel=external target=_blank>Telink Flasher</a> tool in your browser and follow these steps:</p><ol><li>Check the box next to &ldquo;Get Advertising MAC&rdquo;.</li><li>Click on the blue &ldquo;Connect&rdquo; button.</li><li>In the pop-up, look for your sensor and click &ldquo;Pair&rdquo;.<br>The name will probably contain LYWSD03 or ATC (if you&rsquo;ve flashed in in the past).</li><li>Once the connection is established, more buttons and fields will appear on your screen.</li><li>Press the button to select the Zigbee firmware (currently: Z03MMC_v0119.bin).<br><figure class=center><img src=flash_firmware.png alt="Firmware options"><figcaption class=center>Firmware options</figcaption></figure></li><li>A pop-up warning you of the experimental nature of this firmware will appear.<br>Press &ldquo;OK&rdquo;.<br><figure class=center><img src=flash_alert.png alt=Alert><figcaption class=center>Be warned</figcaption></figure></li><li>Press &ldquo;Start Flashing&rdquo;.<br>You can follow the flashing process in the blue box at the top of the page.<br><figure class=center><img src=flash_status.png alt="Flashing status"><figcaption class=center>Flashing&mldr;</figcaption></figure></li><li>Once flashing is done, the blue section will read &ldquo;Status: Disconnected.&rdquo;<br>At the bottom of the page, the logs will also read &ldquo;Update done after xxx seconds&rdquo;.</li></ol><h3 id=connecting-with-zigbee2mqtt>Connecting with Zigbee2MQTT</h3><p>This process is the same as for any other Zigbee device you want to add.</p><ol><li>Take out the battery from the sensor.</li><li>Open the Zigbee2MQTT portal.</li><li>Press the &ldquo;Permit join (All)&rdquo; button or first select a preferred router you want to connect the sensor to.</li><li>Insert the battery into the sensor again and wait until a pop-up appears on the Z2M dashboard.</li><li>Z2M will automatically recognise the device and will configure everything that&rsquo;s needed for the sensor to function.</li><li>If you set up <a href=https://www.zigbee2mqtt.io/guide/usage/integrations/home_assistant.html#controlling-zigbee2mqtt-via-home-assistant title="Zigbee2MQTT Home Assistant integration" rel=external target=_blank>the automation</a>, Home Assistant will also show you a notification indicating a new device joined your network.</li><li>Once the device is set up, you can change it&rsquo;s name (incl. entity id in Home Assistant), give it a description, etc.</li></ol><figure class=center><img src=ha_notification.png alt="Notification in Home Assistant"><figcaption class=center>Device successfully joined the Zigbee network</figcaption></figure><p>And we&rsquo;re done :)</p><p>In less than 2 minutes, our beloved eInk temperature sensor has been converted from BLE to Zigbee!</p><h2 id=lywsd03mmc-z>LYWSD03MMC-z</h2><p>Since version v0120 of pvvx&rsquo;s ZigbeeTlc firmware it appears the device is identified as <code>LYWSD03MMC-z</code> to differentiate it from the devbis firmware version.
As a result of that, Zigbee2MQTT doesn&rsquo;t recognise/support the device (yet).</p><p>To fix this, you need to do is add an External Converter to Z2M.</p><ul><li>Download <a href=https://github.com/pvvx/ZigbeeTLc/blob/master/z2m/lywsd03mmc-z.js title=lywsd03mmc-z.js rel=external target=_blank>lywsd03mmc-z.js</a> and save it in your Z2M config folder.</li><li>In the Z2M dashboard go to Settings > Settings > External converters and add <code>lywsd03mmc-z.js</code>.</li><li>Restart Z2M so it loads the config.</li></ul><p>Previously added devices (that still report as <code>LYWSD03MMC</code> minux the <code>-z</code>) may now start throwing errors.
To fix this, you&rsquo;ll need to remove them from Zigbee2MQTT and join them again.</p><figure class=center><img src=lywsd03mmc-z.png alt="LYWSD03MMC-z in Zigbee2MQTT"><figcaption class=center>Correctly identified as LYWSD03MMC-z</figcaption></figure><p>There&rsquo;s already a <a href=https://github.com/Koenkk/zigbee2mqtt/issues/21467 title=" [New device support]: LYWSD03MMC-z #21467 " rel=external target=_blank>GitHub issue</a> open to add support for the <code>-z</code>.
So, in the future, support for both the devbis and the ZigbeeTlc versions will likely be available out-of-the-box so adding a custom External Converter won&rsquo;t be needed anymore.</p></main><hr><footer><div class=footer><p><div class=previous-post><a href="https://dev.sequr.be/blog/2023/12/remotely-opening-and-closing-my-gate/?ref=footer"><span style=font-weight:700>« Previous</span><br>Remotely opening and closing my gate</a><div class=next-post><a href="https://dev.sequr.be/blog/2024/02/home-assistant-container-part-13-vs-code-code-server/?ref=footer"><span style=font-weight:700>Next »</span><br>Home Assistant Container Part 13: VS Code...</a></div></p></div></footer></article></section><aside class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#flashing-the-lywsd03mmc>Flashing the LYWSD03MMC</a><ul><li><a href=#requirements>Requirements</a></li><li><a href=#flashing-process>Flashing process</a></li><li><a href=#connecting-with-zigbee2mqtt>Connecting with Zigbee2MQTT</a></li></ul></li><li><a href=#lywsd03mmc-z>LYWSD03MMC-z</a></li></ul></nav></div></aside></div></body></html>