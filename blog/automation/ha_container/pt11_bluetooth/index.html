<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head>&lt; <title itemprop=name>Home Assistant Container Part 11: Bluetooth support :: Sequr (dev)</title>
<script defer language=javascript type=text/javascript src=/js/bundle.min.145453261a7755f5042a854c4213501d215a8fbe34c08d181c40f803f1315e74.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=robots content="noodp, noydir"><meta name=googlebot content="noodp, noydir"><link rel=canonical href=https://dev.sequr.be/blog/automation/ha_container/pt11_bluetooth/ itemprop=url><meta name=url content="https://dev.sequr.be/blog/automation/ha_container/pt11_bluetooth/"><link rel=icon href=favicon.ico><meta itemprop=name content="Home Assistant Container Part 11: Bluetooth support"><meta itemprop=description content="In this eleventh part of the Home Assistant Container series we’ll add Bluetooth support to our Home Assistant system"><meta itemprop=datePublished content="2022-11-25T00:00:00+00:00"><meta itemprop=dateModified content="2022-11-25T00:00:00+00:00"><meta itemprop=wordCount content="508"><meta itemprop=image content="https://dev.sequr.be/blog/automation/ha_container/pt11_bluetooth/cover.png"><meta itemprop=keywords content="Home Automation,Home Assistant,Container,Docker,Bluetooth,Dongle"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dev.sequr.be/blog/automation/ha_container/pt11_bluetooth/cover.png"><meta name=twitter:title content="Home Assistant Container Part 11: Bluetooth support"><meta name=twitter:description content="In this eleventh part of the Home Assistant Container series we’ll add Bluetooth support to our Home Assistant system"><meta property="og:url" content="https://dev.sequr.be/blog/automation/ha_container/pt11_bluetooth/"><meta property="og:site_name" content="Sequr (dev)"><meta property="og:title" content="Home Assistant Container Part 11: Bluetooth support"><meta property="og:description" content="In this eleventh part of the Home Assistant Container series we’ll add Bluetooth support to our Home Assistant system"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-11-25T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-25T00:00:00+00:00"><meta property="article:tag" content="Home Automation"><meta property="article:tag" content="Home Assistant"><meta property="article:tag" content="Container"><meta property="article:tag" content="Docker"><meta property="article:tag" content="Bluetooth"><meta property="article:tag" content="Dongle"><meta property="og:image" content="https://dev.sequr.be/blog/automation/ha_container/pt11_bluetooth/cover.png"><meta name=description content="In this eleventh part of the Home Assistant Container series we&rsquo;ll add Bluetooth support to our Home Assistant system"><meta itemprop=description content="In this eleventh part of the Home Assistant Container series we&rsquo;ll add Bluetooth support to our Home Assistant system"><meta property="og:updated_time" content="2022-11-25T00:00:00Z"><link rel=sitemap type=application/xml title=Sitemap href=https://dev.sequr.be/sitemap.xml><meta name=apple-mobile-web-app-title content="Sequr (dev)"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><link type=text/css rel=stylesheet href=/css/bundle.min.94a339836f89f0d25f31980cb6b0631da21e20af128308747ce44e0525eb16ef.css integrity="sha256-lKM5g2+J8NJfMZgMtrBjHaIeIK8Sgwh0fOROBSXrFu8=" crossorigin=anonymous><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#5A5A5A;--link-color:#268BD2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#000;--code-background-color:#E5E5E5;--code-block-color:#FFF;--code-block-background-color:#272822;--moon-sun-color:#FFF;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#EEE;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#9D9D9D;--link-color:#268BD2;--date-color:#9A9A9A;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#FFF;--code-background-color:#515151;--code-block-color:#FFF;--code-block-background-color:#272822}body{background-color:var(--bkg-color)}</style></head><body><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://dev.sequr.be/><img src=logo.png alt="brand image">
</a><a href=https://dev.sequr.be/><h1>Sequr (dev)</h1></a></h1><p class=lead>Dev version of sequr.be. This site may break at any time.</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/about/>About</a></li><li class=heading>Blog</li><li class=heading><a href=/privacy/>Privacy</a></li></ul></nav><a target=_blank class=social title="RSS Feed" href=/posts/index.xml><svg width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><p class=footnote>&copy; 2019
• <a class="p-name u-url" href=https://sequr.be>DezeStijn</a>
• &lt;a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0&lt;/a></p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://dev.sequr.be/blog/automation/ha_container/pt11_bluetooth/>Home Assistant Container Part 11: Bluetooth support</a></h1><div class=headline><div><span>DezeStijn - </span><time datetime=2022-11-25T00:00:00Z class=post-date>November 25, 2022
</time><span>- </span><span class=reading-time><span>3 mins read</span></span></div><ul class=tags><li class="tag-Home Automation"><a href=https://dev.sequr.be/tags/home-automation>Home Automation</a></li><li class="tag-Home Assistant"><a href=https://dev.sequr.be/tags/home-assistant>Home Assistant</a></li><li class=tag-Container><a href=https://dev.sequr.be/tags/container>Container</a></li><li class=tag-Docker><a href=https://dev.sequr.be/tags/docker>Docker</a></li><li class=tag-bluetooth><a href=https://dev.sequr.be/tags/bluetooth>bluetooth</a></li><li class=tag-dongle><a href=https://dev.sequr.be/tags/dongle>dongle</a></li></ul></div></div><h2 id=intro>Intro</h2><p>You may have purchases some <a href=https://s.click.aliexpress.com/e/_Ac9pCh title="Xiaomi Bluetooth Temperature Humidity Sensor LYWSD03MMC" target=_blank>Xiaomi temperature and humidity sensors</a> after reading <a href=/blog/automation/xiaomi_temp_sensor/ title="Room temperature monitoring using Xiaomi temperature sensor, ESP32 and ESPHome">my blog post</a> from a while back.</p><p>Since then, Nabu Casa (the organisation behind Home Assistant) has somewhat taken over the ESPHome project and have been doing their best to incorporate the best of both worlds.
One feature that&rsquo;s of particular relevance is this story, is the native support for Bluetooth LE devices within HA and the addition of the <a href=https://esphome.io/components/bluetooth_proxy.html title="ESPHome Bluetooth Proxy component" target=_blank>Bluetooth Proxy component</a> to ESPHome.</p><p>So from now on, you no longer need to add keys etc. for your Xiaomi BLE sensors to your ESPHome config.
You can connect directly from your Home Assistant system, provided it has a bluetooth chip, or sprinkle some ESP32 (configured as BLE proxy) around.</p><h2 id=the-esphome-method>The ESPHome method</h2><p>If you already have some ESP32 around the house, maybe because you were using the method of <a href=/blog/automation/xiaomi_temp_sensor/ title="Room temperature monitoring using Xiaomi temperature sensor, ESP32 and ESPHome">my old blog post</a>, this is by far the easiest solution.</p><p>In your ESP32 you probably had a section looking like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>esp32_ble_tracker</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>sensor</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># LYWSD03MMC - Advertising Type: Mi Like</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>xiaomi_lywsd03mmc</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>mac_address</span>: <span style=color:#e6db74>&#34;XX:XX:XX:XX:XX:XX&#34;</span> <span style=color:#75715e># Replace with MAC Address of sensor</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>bindkey</span>: <span style=color:#e6db74>&#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span> <span style=color:#75715e># Replace with bind key, use a dummy value when flashed with custom firmware</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>temperature</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;${sensor_name_lywsd03} - Temperature&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>humidity</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;${sensor_name_lywsd03} - Humidity&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>battery_level</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;${sensor_name_lywsd03} - Battery Level&#34;</span>
</span></span></code></pre></div><p>All of this can be removed from the ESPHome config and be replaced by:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>esp32_ble_tracker</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>bluetooth_proxy</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>active</span>: <span style=color:#66d9ef>false</span> <span style=color:#75715e># Default</span>
</span></span></code></pre></div><p>Bluetooth devices will now appear as new integrations in Home Assistant.
You may need to enter the bindkey from your old ESPHome config when adding the devices to HA, so Home Assistant can decrypt the bluetooth packages.</p><h2 id=the-built-in-bluetooth-method>The built-in Bluetooth method</h2><p>This method is useful for when the system you&rsquo;re running Home Assistant on has a built-in Bluetooth chip or you&rsquo;re using a Bluetooth USB dongle.
If you want to use a Bluetooth dongle, make sure you check the <a href=https://www.home-assistant.io/integrations/bluetooth/ title="Bluetooth - Home Assistant" target=_blank>Bluetooth Integration</a> documentation for the list of known-working adapters.</p><p>To then get Home Assistant to recognize your Bluetooth chip/adapter, follow these steps:</p><ol><li>Install <a href=https://github.com/bus1/dbus-broker/wiki title="DBus broker" target=_blank>DBus-broker</a> package <code>sudo apt install dbus-broker</code></li><li>Enable system service <code>sudo systemctl enable dbus-broker.service</code></li><li>Install <a href=http://www.bluez.org/ title=BlueZ target=_blank>BlueZ</a> package <code>sudo apt install bluez</code></li><li>Forward the Dbus socket to HA container by mapping it as a volume in your <code>docker-compose.yaml</code>.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>/opt/homeassistant/config:/config</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>/etc/localtime:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>/run/dbus:/run/dbus:ro</span> <span style=color:#75715e># &lt;-- Bluetooth adapter</span>
</span></span></code></pre></div></li><li>Rebuild your Home Assistant container by running <code>docker-compose up -d homeassistant</code>.</li></ol><p>Once Home Assistant has rebooted, it&rsquo;ll show a new integration for your Bluetooth adapter.
After adding that integration, it&rsquo;ll start discovering BLE devices and showing them as discovered integrations.</p><figure class=center><img src=bluetooth_integration.png alt="New Bluetooth integration available"><figcaption class=center>New Bluetooth integration available</figcaption></figure><p>This update to ESPHome and Home Assistant has made it even easier to work with Bluetooth sensors.</p><h2 id=bthome>BTHome</h2><p>Once final tip:</p><p>Ideally, you&rsquo;d also flash the sensors so they would communicate/advertise using the <a href=https://bthome.io/ title="BTHome open standard" target=_blank>BTHome</a> open standard.</p><blockquote><p>BTHome is an open standard for broadcasting sensor data and button presses over Bluetooth LE</p></blockquote><p>Home Assistant supports it out of the box, and the process for flashing your Xiaomi sensors is the same but it uses an updated <a href=https://pvvx.github.io/ATC_MiThermometer/TelinkMiFlasher.html title="Telink Flasher" target=_blank>Telink Flasher</a>.</p><hr><div class=footer><a class=previous-post href="https://dev.sequr.be/blog/automation/ha_container/pt10_z2m/?ref=footer"><span style=font-weight:700>« Previous</span><br>Home Assistant Container Part 10: Zigbee2MQTT</a><div class=next-post><a href="https://dev.sequr.be/blog/automation/ha_container/pt12_podman/?ref=footer"><span style=font-weight:700>Next »</span><br>Home Assistant Container Part 12: Migrating to...</a></div></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#the-esphome-method>The ESPHome method</a></li><li><a href=#the-built-in-bluetooth-method>The built-in Bluetooth method</a></li><li><a href=#bthome>BTHome</a></li></ul></nav></div></div></div></body></html>