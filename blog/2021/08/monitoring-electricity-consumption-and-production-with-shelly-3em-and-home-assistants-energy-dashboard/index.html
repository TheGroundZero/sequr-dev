<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><title itemprop=name>Monitoring electricity consumption and production with Shelly 3EM and Home Assistant's Energy Dashboard :: Sequr (dev)</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=robots content="noodp, noydir"><meta name=googlebot content="noodp, noydir"><link rel=canonical href=https://dev.sequr.be/ itemprop=url><meta name=url content="https://dev.sequr.be/"><link rel=icon href=/favicon.ico><meta itemprop=name content="Sequr (dev)"><meta itemprop=description content="Dev version of sequr.be. This site may break at any time."><meta itemprop=datePublished content="2024-11-20T00:00:00+01:00"><meta itemprop=dateModified content="2024-11-20T00:00:00+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Sequr (dev)"><meta name=twitter:description content="Dev version of sequr.be. This site may break at any time."><meta property="og:url" content="https://dev.sequr.be/"><meta property="og:site_name" content="Sequr (dev)"><meta property="og:title" content="Sequr (dev)"><meta property="og:description" content="Dev version of sequr.be. This site may break at any time."><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta name=description content="Dev version of sequr.be. This site may break at any time."><meta itemprop=description content="Dev version of sequr.be. This site may break at any time."><meta property="og:updated_time" content="2024-11-20T00:00:00+01:00"><link rel=sitemap type=application/xml title=Sitemap href=https://dev.sequr.be/sitemap.xml><link href=https://dev.sequr.be/index.xml rel=alternate type=application/rss+xml title="Sequr (dev)"><meta name=apple-mobile-web-app-title content="Sequr (dev)"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><link rel=stylesheet href=/css/bundle.css><script defer type=text/javascript src=/js/bundle.min.145453261a7755f5042a854c4213501d215a8fbe34c08d181c40f803f1315e74.js integrity="sha256-FFRTJhp3VfUEKoVMQhNQHSFaj740wI0YHED4A/ExXnQ=" crossorigin=anonymous></script></head><body class=dark-theme><div class=wrapper><aside class="sidebar h-card background-image"><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class="sidebar-about hcard"><h1 class=brand><a href=https://dev.sequr.be/><img src=/logo.png class="u-logo u-photo" alt="Sequr (dev) brand image">
</a><a href=https://dev.sequr.be/ class="u-url p-org"><h1>Sequr (dev)</h1></a></h1><p class="lead p-note">Dev version of sequr.be. This site may break at any time.</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/about/ title=About>About</a></li><li class=heading><a href=/blog/ title=Blog>Blog</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://dev.sequr.be/blog/2024/09/flashing-the-ikea-vindriktning-with-tasmota-and-esphome/ title="Flashing the IKEA Vindriktning with Tasmota and ESPHome">IKEA Vindriktning in HA</a></li><li class=bullet><a href=https://dev.sequr.be/blog/2024/02/home-assistant-container-part-13-vs-code-code-server/ title="Home Assistant Container Part 13: VS Code code-server">HA Containter pt13: VS Code</a></li><li class=bullet><a href=https://dev.sequr.be/blog/2024/02/flash-xiaomi-lywsd03mmc-ble-sensor-with-zigbee-firmware/ title="Flash Xiaomi LYWSD03MMC BLE sensor with Zigbee firmware">Xiaomi LYWSD03MMC with Zigbee</a></li><li class=bullet><a href=https://dev.sequr.be/blog/2023/12/remotely-opening-and-closing-my-gate/ title="Remotely opening and closing my gate">HA gate controller</a></li><li class=bullet><a href=https://dev.sequr.be/blog/2023/10/2-months-in/ title="2 months in">2 months in</a></li><li class=heading><a href=/shoppinglist/ title="Shopping List">Shopping</a></li><li class=heading><a href=/privacy/ title="Privacy Statement">Privacy</a></li></ul></nav><a target=_blank class=social title="RSS Feed" href=/blog/index.xml><svg width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg>
</a><a href=https://bsky.app/profile/sequr.be target=_blank class="u-url social" rel="external noopener me" title=Bluesky><svg width="1.2em" height="1.2em" viewBox="0 0 568 501"><path fill="currentcolor" d="M123.121 33.6637C188.241 82.5526 258.281 181.681 284 234.873c25.719-53.192 95.759-152.3204 160.879-201.2093C491.866-1.61183 568-28.9064 568 57.9464 568 75.2916 558.055 203.659 552.222 224.501c-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281C285.169 375.812 284.017 372.431 284 375.306 283.983 372.431 282.831 375.812 280.369 383.039c-13.43 39.422-65.842 193.273-185.7023 70.281C31.5556 388.56 60.7778 323.8 175.653 304.249 109.933 315.434 36.0535 296.954 15.7778 224.501 9.94525 203.659.0 75.2916.0 57.9464.0-28.9064 76.1345-1.61183 123.121 33.6637z"/></svg></a><a href=https://mastodon-belgium.be/@TerraGloba target=_blank class="u-url social" rel="external noopener me" title=Mastodon><svg width="1.2em" height="1.2em" viewBox="0 0 568 501"><path fill="currentcolor" d="M123.121 33.6637C188.241 82.5526 258.281 181.681 284 234.873c25.719-53.192 95.759-152.3204 160.879-201.2093C491.866-1.61183 568-28.9064 568 57.9464 568 75.2916 558.055 203.659 552.222 224.501c-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281C285.169 375.812 284.017 372.431 284 375.306 283.983 372.431 282.831 375.812 280.369 383.039c-13.43 39.422-65.842 193.273-185.7023 70.281C31.5556 388.56 60.7778 323.8 175.653 304.249 109.933 315.434 36.0535 296.954 15.7778 224.501 9.94525 203.659.0 75.2916.0 57.9464.0-28.9064 76.1345-1.61183 123.121 33.6637z"/></svg></a><a href=https://github.com/TheGroundZero target=_blank class="u-url social" rel="external noopener me" title=Github><svg width="1.2em" height="1.2em" viewBox="0 0 568 501"><path fill="currentcolor" d="M123.121 33.6637C188.241 82.5526 258.281 181.681 284 234.873c25.719-53.192 95.759-152.3204 160.879-201.2093C491.866-1.61183 568-28.9064 568 57.9464 568 75.2916 558.055 203.659 552.222 224.501c-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281C285.169 375.812 284.017 372.431 284 375.306 283.983 372.431 282.831 375.812 280.369 383.039c-13.43 39.422-65.842 193.273-185.7023 70.281C31.5556 388.56 60.7778 323.8 175.653 304.249 109.933 315.434 36.0535 296.954 15.7778 224.501 9.94525 203.659.0 75.2916.0 57.9464.0-28.9064 76.1345-1.61183 123.121 33.6637z"/></svg></a><a href=https://twitter.com/DezeStijn target=_blank class="u-url social" rel="external noopener me" title=Twitter><svg width="1.2em" height="1.2em" viewBox="0 0 568 501"><path fill="currentcolor" d="M123.121 33.6637C188.241 82.5526 258.281 181.681 284 234.873c25.719-53.192 95.759-152.3204 160.879-201.2093C491.866-1.61183 568-28.9064 568 57.9464 568 75.2916 558.055 203.659 552.222 224.501c-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281C285.169 375.812 284.017 372.431 284 375.306 283.983 372.431 282.831 375.812 280.369 383.039c-13.43 39.422-65.842 193.273-185.7023 70.281C31.5556 388.56 60.7778 323.8 175.653 304.249 109.933 315.434 36.0535 296.954 15.7778 224.501 9.94525 203.659.0 75.2916.0 57.9464.0-28.9064 76.1345-1.61183 123.121 33.6637z"/></svg></a><a href=https://ko-fi.com/s4squatch target=_blank class="u-url social" rel="external noopener" title=Kofi><svg width="1.2em" height="1.2em" viewBox="0 0 568 501"><path fill="currentcolor" d="M123.121 33.6637C188.241 82.5526 258.281 181.681 284 234.873c25.719-53.192 95.759-152.3204 160.879-201.2093C491.866-1.61183 568-28.9064 568 57.9464 568 75.2916 558.055 203.659 552.222 224.501c-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281C285.169 375.812 284.017 372.431 284 375.306 283.983 372.431 282.831 375.812 280.369 383.039c-13.43 39.422-65.842 193.273-185.7023 70.281C31.5556 388.56 60.7778 323.8 175.653 304.249 109.933 315.434 36.0535 296.954 15.7778 224.501 9.94525 203.659.0 75.2916.0 57.9464.0-28.9064 76.1345-1.61183 123.121 33.6637z"/></svg></a><p class=footnote>&copy; 2019
• <a class="p-name u-url" href=https://sequr.be>Sequr</a>
• <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel="external noopener">CC BY-NC-SA 4.0</a></p></div></aside><section class="content container"><article class="post h-entry"><header class=info><h1 class="post-title p-name u-url"><a href=https://dev.sequr.be/blog/2021/08/monitoring-electricity-consumption-and-production-with-shelly-3em-and-home-assistants-energy-dashboard/>Monitoring electricity consumption and production with Shelly 3EM and Home Assistant's Energy Dashboard</a></h1><div class=headline><div><span class="h-card p-author">DezeStijn
</span><span>• </span><time datetime=2021-08-18T00:00:00+0200 class="post-date dt-published">Aug 18, 2021
</time><time datetime=2021-09-10T00:00:00+0200 class="post-date dt-updated">(Sep 10, 2021)
</time><span>• </span><span class=reading-time><span>11 mins read</span></span></div><ul class=tags><li class="tag-Home Automation"><a class=p-category href=https://dev.sequr.be/tags/home-automation>Home Automation</a></li></ul></div></header><main class=e-content><h2 id=introduction>Introduction</h2><p>Next to making our lives easier by automating the boring stuff, many people invest in home automation to save money by reducing energy consumption.
These savings are achieved by turning off devices not in use, lowering the temperature in uninhabited rooms, etc.</p><p>Another method of saving energy is making us aware of our energy consumption so that we can change our behaviour.
This is reflected in many fancy and colourful dashboards displaying the energy consumption of lights, heating, dishwashers, AC, etc. present in the setup of many home automation enthusiasts.</p><p>Not only is reducing our energy consumption &ndash; and thus our energy bill &ndash; healthy for our wallets, it&rsquo;s a necessary part of combatting the ongoing climate change.</p><p>The team behind Home Assistant has decided they wanted to do their part by adding an Energy Dashboard to Home Assistant through which users are able to gain more insights into their own energy consumption and production.<br>More info on the addition of Home Energy Management in Home Assistant can be found in their <a href=https://www.home-assistant.io/blog/2021/08/04/home-energy-management/ title="Energy Management in Home Assistant" rel=external target=_blank>blogpost</a>.</p><figure class=center><img src=ha-energy_management.png alt="Logo of Home Assistant Energy Management"><figcaption class=center>Home Energy Management with Home Assistant</figcaption></figure><p>A main part of this dashboard is the visualisation of how much energy is produced and consumed, which devices contribute most to this energy consumption, and at what times energy consumption is highest.
Next to this, additional graphs can be displayed for energy production/consumption and/or individual devices.
The dashboard even allows you to scroll through the data per hour, allowing a detailed view into the energy consumption of your home.</p><figure class=center><img src=ha-energy_diagram.png alt="Diagram of Home Energy Management"><figcaption class=center>Home Energy Management in a diagram</figcaption></figure><p>Knowing for example when our solar production is highest allows us to move our energy consumption to those moments.
Think about doing the laundry or dishes, turning on the AC or charging an electric vehicle (EV) when we have an abundance of energy.
And thanks to home automation, we don&rsquo;t have to manually plug stuff in or press the button on the dishwasher.</p><h2 id=measuring-grid-consumption-with-shelly-3em>Measuring grid consumption with Shelly 3EM</h2><p>Before we can visualise our energy consumption and production, we need to collect the data first.</p><p>How we do this exactly will depend on what we have available.<br>Do you have a smart electricity meter in your home and does it have a P1 port? Then <a href=https://www.home-assistant.io/docs/energy/electricity-grid/#connect-using-a-p1-port title="SlimmeLezer - connect using a P1 port" rel=external target=_blank>SlimmeLezer</a> will allow you to collect the data on consumption and production.<br>No P1 port? Check <a href=https://www.home-assistant.io/docs/energy/electricity-grid/#reading-the-meter-via-a-pulse-counter title="Home Assistant Glow - reading the meter via pulse counter" rel=external target=_blank>Home Assistant Glow</a> out.<br>Or, if you still have a analog meter, the <a href=https://shelly.cloud/knowledge-base/devices/shelly-3em/ title="Shelly 3EM - professional 3 phase energy meter" rel=external target=_blank>Shelly 3EM</a> can help you out.</p><p>My situation is a follows:
My house has 3-phase electricity (3x400V+N) with an analog meter and a photovoltaic (PV/solar) installation with a digital meter.
The digital meter of the solar installation only sends updates twice a day to a portal of the installer.</p><p>In this blog post I will describe my experiences installing a Shelly 3EM to monitor the energy coming from or flowing to the grid,
and using either a phototransistor to read the blinking LED on the digital meter or connecting to its serial port to read the data over modbus.</p><h3 id=wiring-in-the-shelly-3em>Wiring in the Shelly 3EM</h3><p>I will be installing the Shelly 3EM according to the 3-phase wiring diagram found in the manual.
More wiring diagrams can be found on the <a href=https://shelly.cloud/knowledge-base/devices/shelly-3em/ title="Shelly 3EM - professional 3 phase energy meter" rel=external target=_blank>Shelly Knowledge Base</a> page for the 3EM.</p><figure class=center><img src=shelly-3EM-3phasing.jpg alt="Shelly 3EM 3-phase wiring diagram"><figcaption class=center>Shelly 3EM 3-phase wiring diagram</figcaption></figure><p>A clamp is hooked around the incoming wires for each of the phases. These monitor the current (in Amps) flowing through the wire and its direction.<br>The Shelly is also connected to each of these phases via connections VA, VB and VC, and Neutral. This is to measure the Voltage.<br>Multiplying Amps with Volts gives us an energy consumption/production in Watts.</p><p>Optionally, a contactor or low-load device can be hooked up to the I and O terminals of the Shelly.
For example to disconnect an EV charger when there&rsquo;s no PV production.</p><p>At this moment, the Shelly 3EM does not support electricity theft/leakage detection, which would require an additional clamp around outgoing Neutral wire.</p><figure class=center><img src=shelly-3EM-package.jpg alt="Shelly 3EM with its 3 split core current transformers labeled A, B and C"><figcaption class=center>Shelly 3EM with its 120A clamps labeled A, B and C</figcaption></figure><h4 id=1-de-energize-panel>1. De-energize panel</h4><p>Before installing the Shelly, make sure you de-energize your panel.
This is usually done be flipping the main electricity cut-off switch, often located near the meter.
Double-check that the inverter of your solar installation also shut off and is not energizing the panel.</p><p><strong>Always</strong> confirm using an electricity detector or multimeter that there&rsquo;s no electricity flowing through the panel before doing modifications!</p><h4 id=2-mount-shelly>2. Mount Shelly</h4><p>Attach the Shelly 3EM to the DIN rail of your panel on a location that&rsquo;ll allow you to easily run the necessary wires.</p><p>You&rsquo;ll also want to take into account the length of wire the clamps have.</p><p>I decided to install the Shelly such that the clip to hold it onto the DIN rail is on top.
The clamps are then attached to the top of the Shelly and the power wires to the bottom.</p><h4 id=3-attach-clamps>3. Attach clamps</h4><p>Hook the current clamps (split core current transformers) around the incoming wires for each phase.</p><p>Note the arrow on the clamps pointing from &ldquo;K&rdquo; to &ldquo;L&rdquo;.
Where &ldquo;L&rdquo; is the grid or the source of the electricity and &ldquo;K&rdquo; is the household.<br>In other words: install the clamps such that the arrow points <em>towards</em> your electricity meter.</p><p>The clamps are labeled A, B and C, and must be plugged into the respective connectors on the Shelly.</p><figure class=center><img src=shelly-3EM-manual-clamps.jpg alt="Clamp orientation explained in manual"><figcaption class=center>Manual showing clamp orientation</figcaption></figure><p>I hooked up the clamps (marked purple in picture below) on the input side of the main differential.
I would have preferred to hang them on the output side, but multiple wires where leaving on that side (to the subpanel, the 2nd differential and the electric stove) making clamping impossible.<br>I can still de-energize the wires by flicking the main breaker at the meter.</p><p><strong>Never</strong> attach a clamp on an energized wire while it&rsquo;s not connected to the Shelly!</p><h4 id=4-attach-wires>4. Attach wires</h4><p>Connect wires from the VA, VB and VC terminals to breakers on the different phases.
Make sure their order matches the order in which you attached the clamps (VA on same phase as clamp A, etc.).</p><p>The terminals fit 2.5mm² solid core wires.
I stripped them 10mm on both sides.</p><p>These wires are then ran to 3 different fuses (marked orange below) which each are on a different phase.
The Neutral wire is connected to the same fuse as the Live wire for Phase A (marked A-live and A-neutral).</p><figure class=center><img src=shelly-3EM-installed.jpg alt="Picture of Shelly 3EM installed in panel"><figcaption class=center>Shelly 3EM installed in the bottom-left</figcaption></figure><h4 id=5-turn-power-back-on>5. Turn power back on</h4><p>After you&rsquo;ve verified all wires are installed correctly and tightly (pull the wires a few times), you can close the cabinet and re-energize the panel.</p><p>The Shelly&rsquo;s LED will start to flicker, indicating it&rsquo;s in Access Point mode.</p><figure class=center><img src=shelly-3EM-cabinet.jpg alt="Picture of Shelly 3EM with blinking LED"><figcaption class=center>Shelly 3EM active and LED blinking</figcaption></figure><h3 id=setting-up-the-shelly>Setting up the Shelly</h3><h4 id=1-connecting-with-wifi>1. Connecting with WiFi</h4><p>While standing near the Shelly 3EM, open up the WiFi settings of your smartphone.
You should see a new WiFi network names <code>shellyem3-&lt;device_ID></code> pop-up.<br>Connect to this WiFi network and accept any prompt saying you don&rsquo;t have internet connectivity.</p><p>Browse to http://192.168.33.1 to open the web portal of the Shelly (for more info, see <a href=https://sequr.be/blog/2021/01/shelly-web-ui-method/ title="Shelly Web UI method :: Sequr" rel=external target=_blank>this blogpost</a>).</p><figure class=center><img src=shelly-3EM-webui.png alt="Web UI of the Shelly 3EM"><figcaption class=center>Web UI of the Shelly 3EM</figcaption></figure><p>Open the <code>Internet & Security</code> tab and open the <code>WiFi Mode - Client</code> section.
Check the box next to <code>Connect the Shelly device to an existing WiFi Network</code>, enter your WiFi SSID (network name) and password, and click Save.</p><p>The Shelly will no attempt to connect to the WiFi network you&rsquo;ve entered.
The WiFi network of the Shelly will disappear and your phone will connect to your home&rsquo;s WiFi again.</p><h4 id=2-firmware-update--extra-config>2. Firmware update & extra config</h4><p>Find the IP address of your Shelly (e.g. in the router tabel) and browse to it to find the Web UI again.</p><p>Under Settings there&rsquo;s an option to pick the transformer type (50A or 120A).
This option appears to have been removed in a later firmware update, so I&rsquo;m not sure how relevant it is anymore.
But it seemed appropriate to me to set it correctly, i.e. 120A.</p><figure class=center><img src=shelly-3EM-transformers.png alt="Current Transformer Type"><figcaption class=center>Pick 120A for each of the channels</figcaption></figure><p>Still in the Settings Menu, scroll down to <code>Firmware Update</code> and press the big button to update the firmware of the Shelly.</p><figure class=center><img src=shelly-3EM-firmware.png></figure><p>Once the Shelly&rsquo;s updated, the webpage should reload and new options will have appeared.</p><p>Under <code>Settings</code> you can now set a <code>Device Name</code> and <code>Channel # Name</code>.
These names will be reflected in Home Assistant once we integrate the Shelly, so it&rsquo;s useful to set a descriptive name here.</p><figure class=center><img src=shelly-3EM-naming.png></figure><p>While still on the Web UI, you can modify the other settings to fit your needs.
You can enable AP Roaming to have the Shelly move to a different Access Point if the signal become too bad.
You can enable <a href=https://sequr.be/blog/2020/10/getting-started-with-mqtt-and-home-assistant-and-shelly/ title="Getting started with MQTT and Home Assistant (and Shelly) :: Sequr" rel=external target=_blank>MQTT</a> or set <a href=https://sequr.be/blog/2021/03/shelly-colot-unicast/ title="Shelly ColoT unicast :: Sequr" rel=external target=_blank>CoIoT unicast</a> to the IP of your Home Assistant instance.</p><h3 id=integrating-shelly-3em-in-home-assistant>Integrating Shelly 3EM in Home Assistant</h3><p>Home Assistant will most likely have already discovered the Shelly 3EM on your network.
If it hasn&rsquo;t, setting CoIoT to the IP of your HA instance and rebooting the Shelly should help.</p><p>Click the link in the notification to open the Integrations page which prompt to configure the Shelly.</p><figure class=center><img src=shelly-3EM-HA_discovery.png></figure><p>If HA still didn&rsquo;t automatically discover the Shelly, you can manually add a new Shelly integration.</p><p>Home Assistant will automatically integrate all relevant entities, including the energy meters.</p><figure class=center><img src=shelly-3EM-HA_device.png alt="Home Assistant showing the entities for the Shelly 3EM"><figcaption class=center>Shelly 3EM entities</figcaption></figure><p>Notice how there are meters for Energy (consumption) and Energy Returned (overproduction) for all three phases.
We&rsquo;ll need these entities for our Energy Dashboard.</p><h2 id=energy-dashboard>Energy dashboard</h2><p>Now that we have our sensors setup collecting the data we need, we can add them to the Energy Dashboard.</p><h3 id=setup-wizard>Setup Wizard</h3><p>To start, go to the <a href=https://my.home-assistant.io/redirect/config_energy title="Home Assistant energy configuration page" rel=external target=_blank>energy configuration page</a> and follow the wizard.</p><h4 id=1-electricity-grid>1. Electricity Grid</h4><p>In this first step, we add the sensors that contain the data of the energy flow between our house and the grid.
This will be the sensors from the Shelly 3EM.</p><p>Add the &ldquo;Energy&rdquo; sensors for the 3 phases as &ldquo;Grid Consumption&rdquo;.</p><figure class=center><img src=ha-energy_step1_phasea.png alt="Adding Phase A Energy as Grid Consumption meter"><figcaption class=center>Adding Phase A Energy</figcaption></figure><p>If you know the cost of your electricity or have an integration that provides you with this data, you can configure this here as well.
This will allow you to not only track your electricity consumption, but also how much it&rsquo;s costing you.</p><p>Do the same for the other 2 &ldquo;Energy&rdquo; meters and and the &ldquo;Energy Returned&rdquo; meters under the &ldquo;Return to Grid&rdquo; section.
Here you&rsquo;ll also be able to provide the price you get paid for the electricity you put back on the grid.</p><figure class=center><img src=ha-energy_step1.png alt="Energy Dashboard - step 1 of 3"><figcaption class=center>Electricity grid meters</figcaption></figure><h4 id=2-solar-panels>2. Solar Panels</h4><p>In the 2nd part of the wizard, you can add the meter for your solar production.</p><figure class=center><img src=ha-energy_step2.png alt="Energy Dashboard - step 2 of 3"><figcaption class=center>Solar production meters</figcaption></figure><h4 id=3-individual-devices>3. Individual devices</h4><p>In this final part of the wizard, you can add meters for individual devices for which you want to specifically track their consumption.</p><p>For example, a sensor on your Electric Vehicle (EV) charger or your aircondition.</p><figure class=center><img src=ha-energy_step3.png alt="Energy Dashboard - step 3 of 3"><figcaption class=center>Individual device tracking</figcaption></figure><h4 id=finish>Finish</h4><p>When you now close the wizard by clicking <code>Show me my energy dashboard</code>, you&rsquo;ll notice it&rsquo;s still pretty empty.</p><p>This is, as the message on the graph explains, because data still needs to be imported and parsed.
Don&rsquo;t worry, eventually you&rsquo;ll see your data appear here, give it some time.</p><figure class=center><img src=ha-energy_dashboard_unpopulated.png alt="Energy Dashboard - currently still empty"><figcaption class=center>There is no data to show. It can take up to 2 hours for new data to arrive after you configure your energy dashboard.</figcaption></figure><figure class=center><img src=ha-energy_dashboard.png alt="Energy Dashboard - with some data in it"><figcaption class=center>After a few hours, data will start to appear</figcaption></figure><p>Note that the dashboard above doesn&rsquo;t include a sensor for my PV installation yet.
So data on solar energy production isn&rsquo;t included in this dashboard yet.</p><p>The dashboard does show my &lsquo;overproduction&rsquo;, which is reflected in &lsquo;Phase B Energy Returned&rsquo; as my solar panels are hooked up to Phase B.
But at this moment I&rsquo;m missing how much energy I&rsquo;m consuming directly from the PV, and thus not asking from the grid.</p><p>Adding a meter on my solar systems output line would allow me to see how much energy is produced and how much of it was directly consumed.
This will also give me better insights in the total energy consumption of my house.<br>That will be food for <a href=https://sequr.be/blog/2021/08/reading-ginlong-solis-inverter-over-serial-and-importing-in-home-assistant-over-mqtt/ title="Reading Ginlong Solis inverter over serial and importing in Home Assistant over MQTT" rel=external target=_blank>a new blog post</a> :)</p><h3 id=make-changes>Make changes</h3><p>To want to make changes to your Energy Dashboard, go to Configuration > Energy.
Here you can modify the sensors you&rsquo;re using for grid consumption/return, solar panel production, individual device tracking and the Grid Carbon Footprint.</p><p>To modify the currency used for cost calculations, go to Configuration > General.</p><figure class=center><img src=ha-energy_configuration.png alt="Energy Dashboard - configuration screen"><figcaption class=center>Configuration screen for HA Energy Dashboard</figcaption></figure><h3 id=grid-carbon-footprint>Grid Carbon Footprint</h3><p>You can optionally add a &ldquo;Grid carbon footprint&rdquo; sensor as well.</p><p>This service will show you how much of your home&rsquo;s electricity grid comes from Fossil Fuels and what its CO2 intensity is.
Based on this data, you can steer your electricity consumption as to use electricity when its carbon footprint is lowest.</p><p>To add this service, you&rsquo;ll need to add your email address to the <a href=https://co2signal.com/#signup title="CO2 Signal" rel=external target=_blank>CO2 Signal</a> mailing list so you can get an API key.</p><figure class=center><img src=ha-co2signal.png alt="CO2 signal entities"><figcaption class=center>CO2 Signal</figcaption></figure></main><hr><footer><div class=footer><p><div class=previous-post><a href="https://dev.sequr.be/blog/2021/08/playing-webradio-and-other-audio-from-lovelace-dashboard/?ref=footer"><span style=font-weight:700>« Previous</span><br>Playing webradio (and other audio) from Lovelace...</a><div class=next-post><a href="https://dev.sequr.be/blog/2021/08/reading-ginlong-solis-inverter-over-serial-and-importing-in-home-assistant-over-mqtt/?ref=footer"><span style=font-weight:700>Next »</span><br>Reading Ginlong Solis inverter over serial and...</a></div></p></div></footer></article></section><aside class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#measuring-grid-consumption-with-shelly-3em>Measuring grid consumption with Shelly 3EM</a><ul><li><a href=#wiring-in-the-shelly-3em>Wiring in the Shelly 3EM</a><ul><li><a href=#1-de-energize-panel>1. De-energize panel</a></li><li><a href=#2-mount-shelly>2. Mount Shelly</a></li><li><a href=#3-attach-clamps>3. Attach clamps</a></li><li><a href=#4-attach-wires>4. Attach wires</a></li><li><a href=#5-turn-power-back-on>5. Turn power back on</a></li></ul></li><li><a href=#setting-up-the-shelly>Setting up the Shelly</a><ul><li><a href=#1-connecting-with-wifi>1. Connecting with WiFi</a></li><li><a href=#2-firmware-update--extra-config>2. Firmware update & extra config</a></li></ul></li><li><a href=#integrating-shelly-3em-in-home-assistant>Integrating Shelly 3EM in Home Assistant</a></li></ul></li><li><a href=#energy-dashboard>Energy dashboard</a><ul><li><a href=#setup-wizard>Setup Wizard</a><ul><li><a href=#1-electricity-grid>1. Electricity Grid</a></li><li><a href=#2-solar-panels>2. Solar Panels</a></li><li><a href=#3-individual-devices>3. Individual devices</a></li><li><a href=#finish>Finish</a></li></ul></li><li><a href=#make-changes>Make changes</a></li><li><a href=#grid-carbon-footprint>Grid Carbon Footprint</a></li></ul></li></ul></nav></div></aside></div></body></html>